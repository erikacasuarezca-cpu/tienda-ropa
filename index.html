<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bluvix Store</title>
<link rel="stylesheet" href="style.css">
</head>

<body>

<!-- ==========================================================
     ENCABEZADO
=========================================================== -->
<header>
  <h1 class="titulo">BLUVIX STORE</h1>
  <p class="slogan">Tu estilo, tu vibra, tu mundo.</p>
</header>

<!-- ==========================================================
     LOGIN Y REGISTRO
=========================================================== -->
<div id="authContainer" class="centerBox">

  <!-- Login -->
  <div id="loginBox" class="authCard">
    <h2>ğŸ” Iniciar SesiÃ³n</h2>

    <input id="loginUser" placeholder="Usuario">
    <input id="loginPass" type="password" placeholder="ContraseÃ±a">

    <button id="btnLogin" class="btn">Entrar</button>

    <p class="switchAuth">Â¿No tienes cuenta? <span id="goRegister">RegÃ­strate</span></p>
    <p id="loginError" class="errorMsg"></p>
  </div>

  <!-- Registro -->
  <div id="registerBox" class="authCard hidden">
    <h2>ğŸ“ Crear Cuenta</h2>

    <input id="regUser" placeholder="Nuevo usuario">
    <input id="regPass" type="password" placeholder="ContraseÃ±a">

    <button id="btnRegister" class="btn">Registrar</button>

    <p class="switchAuth">Â¿Ya tienes cuenta? <span id="goLogin">Inicia sesiÃ³n</span></p>
    <p id="registerError" class="errorMsg"></p>
  </div>
</div>

<!-- ==========================================================
     BIENVENIDA USUARIO
=========================================================== -->
<section id="bienvenidaBox" class="usuario hidden">
  <h2>ğŸ‘‹ Bienvenido <span id="nombreUsuario"></span></h2>
  <button id="btnLogout" class="logoutBtn">Cerrar sesiÃ³n</button>
</section>

<!-- ==========================================================
     BOTÃ“N ADMIN
=========================================================== -->
<div id="adminBtnBox" class="center hidden">
  <button id="btnAdminPanel" class="adminBtn">Modo Administrador</button>
</div>

<!-- ==========================================================
     PANEL ADMINISTRADOR
=========================================================== -->
<div id="adminPanel" class="adminPanel hidden">
  <h2>âš™ Panel Administrador</h2>

  <label>Nombre del producto</label>
  <input id="newName" type="text">

  <label>Precio</label>
  <input id="newPrice" type="number">

  <label>CategorÃ­a</label>
  <select id="newCategory">
    <option>Superiores</option>
    <option>Inferiores</option>
    <option>Accesorios</option>
    <option>Calzado</option>
  </select>

  <label>Imagen</label>
  <input id="newImageFile" type="file" accept="image/*">

  <img id="previewImage" class="preview hidden">

  <button id="btnAddProduct" class="btn">Agregar Producto</button>

  <h3>Eliminar productos</h3>
  <div id="adminDeleteList"></div>

  <button id="btnExitAdmin" class="btnExitAdmin">Salir del modo Admin</button>
</div>

<!-- ==========================================================
     CARRITO ICONO
=========================================================== -->
<div id="carritoWidget">ğŸ›’ <span id="cartCount">0</span></div>

<!-- ==========================================================
     PANEL LATERAL DEL CARRITO
=========================================================== -->
<div id="carritoPanel" class="carritoPanel hidden">
  <h2>ğŸ›’ Tu Carrito</h2>
  <div id="carritoItems"></div>

  <h3>Total: $<span id="totalCarrito">0</span></h3>

  <button id="btnSimularCompra" class="btn pagarBtn">Finalizar compra</button>
  <button id="btnCerrarCarrito" class="btnClose">Cerrar</button>
</div>

<!-- ==========================================================
     MODAL DE PAGO
=========================================================== -->
<div id="modalPago" class="modal hidden">
  <div class="modalContent">
    <h2>ğŸ’³ MÃ©todo de Pago</h2>

    <select id="metodoPago">
      <option value="">Seleccione una opciÃ³n</option>
      <option>Tarjeta</option>
      <option>Nequi</option>
      <option>Daviplata</option>
      <option>PSE</option>
      <option>Efectivo contraentrega</option>
    </select>

    <button id="btnProcesarPago" class="btn">Continuar</button>

    <button id="btnCerrarPago" class="btnClose">Cerrar</button>
  </div>
</div>

<!-- Modal procesando -->
<div id="procesandoPago" class="modal hidden">
  <div class="modalContent">
    <h2>â³ Realizando pago...</h2>
  </div>
</div>

<!-- Modal final -->
<div id="pagoFinalizado" class="modal hidden">
  <div class="modalContent">
    <h2>âœ” Pago Finalizado</h2>
    <p>Gracias por tu compra ğŸ›ï¸</p>
    <button id="btnCerrarFinal" class="btn">Aceptar</button>
  </div>
</div>

<!-- ==========================================================
     CATEGORÃAS FILTRO (AHORA CON INFERIORES)
=========================================================== -->
<div id="categoriasBox" class="categorias hidden">
  <button onclick="filtrar('Todos')" class="catBtn activo">Todos</button>
  <button onclick="filtrar('Superiores')" class="catBtn">Superiores</button>
  <button onclick="filtrar('Inferiores')" class="catBtn">Inferiores</button>
  <button onclick="filtrar('Accesorios')" class="catBtn">Accesorios</button>
  <button onclick="filtrar('Calzado')" class="catBtn">Calzado</button>
</div>

<!-- ==========================================================
     CATÃLOGO
=========================================================== -->
<section id="catalogo" class="catalogo hidden"></section>

<!-- ==========================================================
     JAVASCRIPT
=========================================================== -->
<script>

/* ---------------- LOGIN / REGISTRO ---------------- */
let usuarios = JSON.parse(localStorage.getItem("usuariosBluvix")) || [];

goRegister.onclick = () => {
  loginBox.classList.add("hidden");
  registerBox.classList.remove("hidden");
};

goLogin.onclick = () => {
  registerBox.classList.add("hidden");
  loginBox.classList.remove("hidden");
};

btnRegister.onclick = () => {
  let u = regUser.value.trim();
  let p = regPass.value.trim();

  if (!u || !p)
    return registerError.textContent = "Completa ambos campos.";

  if (usuarios.some(x => x.user === u))
    return registerError.textContent = "Ese usuario ya existe.";

  usuarios.push({ user: u, pass: p });
  localStorage.setItem("usuariosBluvix", JSON.stringify(usuarios));

  registerError.style.color = "lightgreen";
  registerError.textContent = "Usuario creado";

  setTimeout(() => {
    registerBox.classList.add("hidden");
    loginBox.classList.remove("hidden");
  }, 700);
};

btnLogin.onclick = () => {
  let usr = loginUser.value.trim();
  let pass = loginPass.value.trim();

  let ok = usuarios.find(x => x.user === usr && x.pass === pass);
  if (!ok) return loginError.textContent = "Datos incorrectos";

  localStorage.setItem("sesionBluvix", usr);
  mostrarTienda(usr);
};

btnLogout.onclick = () => {
  localStorage.removeItem("sesionBluvix");
  location.reload();
};

let ses = localStorage.getItem("sesionBluvix");
if (ses) mostrarTienda(ses);

function mostrarTienda(u) {
  authContainer.classList.add("hidden");
  bienvenidaBox.classList.remove("hidden");
  adminBtnBox.classList.remove("hidden");
  categoriasBox.classList.remove("hidden");
  catalogo.classList.remove("hidden");
  nombreUsuario.textContent = u;
}

/* ---------------- PRODUCTOS BASE ---------------- */
let productos = JSON.parse(localStorage.getItem("productosBluvix")) || [
  { id: 1, nombre: "Camiseta", precio: 45000, categoria: "Superiores", img: "img/camiseta.jpg" },
  { id: 2, nombre: "Gorra", precio: 25000, categoria: "Accesorios", img: "img/gorra.jpg" },
  { id: 3, nombre: "Sudadera", precio: 90000, categoria: "Superiores", img: "img/sudadera.jpg" },
  { id: 4, nombre: "Tenis", precio: 210000, categoria: "Calzado", img: "img/tenis.jpg" }
];

function guardarProductos() {
  localStorage.setItem("productosBluvix", JSON.stringify(productos));
}

/* ---------------- CATEGORÃAS/FILTRO ---------------- */
let filtroActual = "Todos";

function filtrar(cat) {
  filtroActual = cat;

  document.querySelectorAll(".catBtn").forEach(b => b.classList.remove("activo"));
  [...document.querySelectorAll(".catBtn")].find(b => b.innerText === cat).classList.add("activo");

  mostrarCatalogo();
}

/* ---------------- MOSTRAR CATÃLOGO ---------------- */
function mostrarCatalogo() {
  catalogo.innerHTML = "";

  productos
    .filter(p => filtroActual === "Todos" || p.categoria === filtroActual)
    .forEach(p => {
      catalogo.innerHTML += `
        <div class="card">
          <img src="${p.img}">
          <h3>${p.nombre}</h3>
          <p class="precio">$${p.precio.toLocaleString()}</p>
          <button class="btnAdd" onclick="agregarCarrito(${p.id})">Agregar al carrito</button>
        </div>
      `;
    });
}

mostrarCatalogo();

/* ---------------- CARRITO ---------------- */
let carrito = JSON.parse(localStorage.getItem("carritoBluvix")) || [];
cartCount.textContent = carrito.length;

carritoWidget.onclick = () => carritoPanel.classList.remove("hidden");
btnCerrarCarrito.onclick = () => carritoPanel.classList.add("hidden");

function agregarCarrito(id) {
  carrito.push(id);
  localStorage.setItem("carritoBluvix", JSON.stringify(carrito));
  cartCount.textContent = carrito.length;
  actualizarCarrito();
}

function actualizarCarrito() {
  carritoItems.innerHTML = "";

  let agrupado = {};
  carrito.forEach(id => agrupado[id] = (agrupado[id] || 0) + 1);

  let total = 0;

  for (let id in agrupado) {
    let p = productos.find(x => x.id == id);
    let cantidad = agrupado[id];
    let subtotal = p.precio * cantidad;
    total += subtotal;

    carritoItems.innerHTML += `
      <div class="carritoItem">
        <img src="${p.img}">
        <div class="infoCarrito">
          <h4>${p.nombre} (x${cantidad})</h4>
          <p>Unitario: $${p.precio.toLocaleString()}</p>
          <p>Subtotal: $${subtotal.toLocaleString()}</p>

          <div class="cantBtns">
            <button onclick="sumar(${id})">+</button>
            <button onclick="restar(${id})">-</button>
          </div>
        </div>

        <button class="btnQuitar" onclick="eliminarTodo(${id})">ğŸ—‘ï¸</button>
      </div>
    `;
  }

  totalCarrito.textContent = total.toLocaleString();
}
actualizarCarrito();

/* BotÃ³n + */
function sumar(id) {
  carrito.push(id);
  localStorage.setItem("carritoBluvix", JSON.stringify(carrito));
  cartCount.textContent = carrito.length;
  actualizarCarrito();
}

/* BotÃ³n â€“ */
function restar(id) {
  let index = carrito.indexOf(id);
  if (index !== -1) carrito.splice(index, 1);

  localStorage.setItem("carritoBluvix", JSON.stringify(carrito));
  cartCount.textContent = carrito.length;
  actualizarCarrito();
}

/* Eliminar completamente un producto */
function eliminarTodo(id) {
  carrito = carrito.filter(x => x !== id);
  localStorage.setItem("carritoBluvix", JSON.stringify(carrito));
  cartCount.textContent = carrito.length;
  actualizarCarrito();
}

/* ---------------- ADMIN ---------------- */
btnAdminPanel.onclick = () => {
  let clave = prompt("Ingrese clave de administrador:");
  if (clave === "admin") adminPanel.classList.remove("hidden");
  else alert("Clave incorrecta.");
};

btnExitAdmin.onclick = () => adminPanel.classList.add("hidden");

newImageFile.onchange = () => {
  let reader = new FileReader();
  reader.onload = e => {
    previewImage.src = e.target.result;
    previewImage.classList.remove("hidden");
  };
  reader.readAsDataURL(newImageFile.files[0]);
};

btnAddProduct.onclick = () => {
  if (!newName.value || !newPrice.value || !newImageFile.files[0])
    return alert("Completa todos los campos");

  let reader = new FileReader();

  reader.onload = e => {
    productos.push({
      id: Date.now(),
      nombre: newName.value,
      categoria: newCategory.value,
      precio: parseInt(newPrice.value),
      img: e.target.result
    });

    guardarProductos();
    mostrarCatalogo();
    generarListaAdmin();
  };

  reader.readAsDataURL(newImageFile.files[0]);
};

function generarListaAdmin() {
  adminDeleteList.innerHTML = "";
  productos.forEach(p => {
    adminDeleteList.innerHTML += `
      <div class="delItem">
        ${p.nombre} (${p.categoria}) - $${p.precio.toLocaleString()}
        <button onclick="eliminarProd(${p.id})">âŒ</button>
      </div>
    `;
  });
}
generarListaAdmin();

function eliminarProd(id) {
  productos = productos.filter(x => x.id !== id);
  guardarProductos();
  mostrarCatalogo();
  generarListaAdmin();
}

/* ---------------- SIMULACIÃ“N DE COMPRA ---------------- */
btnSimularCompra.onclick = () => modalPago.classList.remove("hidden");
btnCerrarPago.onclick = () => modalPago.classList.add("hidden");

btnProcesarPago.onclick = () => {
  if (!metodoPago.value) return alert("Seleccione un mÃ©todo de pago");

  modalPago.classList.add("hidden");
  procesandoPago.classList.remove("hidden");

  setTimeout(() => {
    procesandoPago.classList.add("hidden");
    pagoFinalizado.classList.remove("hidden");

    carrito = [];
    localStorage.setItem("carritoBluvix", JSON.stringify(carrito));
    cartCount.textContent = 0;
    actualizarCarrito();
  }, 2000);
};

btnCerrarFinal.onclick = () => pagoFinalizado.classList.add("hidden");

</script>

</body>
</html>
